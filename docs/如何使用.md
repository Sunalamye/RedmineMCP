# Redmine MCP 使用指南

## 快速開始

### 1. 安裝

```bash
# 解壓縮
unzip redmine-mcp-*.zip

# 執行安裝腳本
./install.sh
```

### 2. 取得 API Token

1. 登入你的 Redmine
2. 點擊右上角帳號 → **我的帳戶**
3. 在頁面右側找到 **API 存取金鑰**
4. 點擊 **顯示** 取得 Token

### 3. 開始使用

在 Claude Code 或 OpenCode 中直接輸入指令：

```
取得我的 Issues
```

---

## 可用工具

| 工具 | 說明 |
|------|------|
| `redmine_get_issues` | 取得 Issues 列表 |
| `redmine_get_issue` | 取得單一 Issue 詳情 |
| `redmine_get_projects` | 取得專案列表 |
| `redmine_get_trackers` | 取得追蹤標籤列表 |
| `redmine_get_statuses` | 取得狀態列表 |
| `redmine_get_project_members` | 取得專案成員 |
| `redmine_get_current_user` | 取得當前使用者資訊 |

---

## 使用範例

### 查詢 Issues

```
# 取得所有開啟的 Issues
取得所有開啟的 Issues

# 取得指派給我的 Issues
取得指派給我的 Issues

# 取得特定專案的 Issues
取得 my-project 專案的 Issues
```

### 查詢單一 Issue

```
# 使用 Issue ID
取得 Issue #12345 的詳情

# 使用 Redmine URL（需要 Skill）
查看這個 Issue：https://your-redmine.example.com/issues/12345
```

### 使用 URL 查詢（Skill 功能）

如果你複製了 Redmine 網頁的 URL，可以直接貼上：

```
# 單一 Issue URL
https://your-redmine.example.com/issues/12345

# Issues 列表 URL（含篩選條件）
https://your-redmine.example.com/projects/my-project/issues?set_filter=1&f[]=status_id&op[status_id]=o
```

MCP 會自動解析 URL 並呼叫對應的 API。

---

## API 參數說明

### redmine_get_issues

| 參數 | 說明 | 範例 |
|------|------|------|
| `project_id` | 專案 ID | `"my-project"` |
| `status_id` | 狀態 | `"open"`, `"closed"`, `"*"`, `1` |
| `tracker_id` | 追蹤標籤 ID | `20` |
| `assigned_to_id` | 指派對象 | `"me"`, `42`, `"!42"` |
| `limit` | 回傳筆數 | `25` (預設), `100` (最大) |
| `offset` | 跳過筆數 | `0` |
| `sort` | 排序 | `"updated_on:desc"` |

### redmine_get_issue

| 參數 | 說明 | 範例 |
|------|------|------|
| `id` | Issue ID | `12345` |
| `include` | 包含額外資訊 | `"journals,attachments"` |

---

## 進階用法

### 篩選條件運算子

| 運算子 | 說明 | 範例 |
|--------|------|------|
| `=` | 等於 | `tracker_id: 20` |
| `!` | 不等於（排除） | `assigned_to_id: "!42"` |
| `o` | 開啟 | `status_id: "open"` |
| `c` | 關閉 | `status_id: "closed"` |
| `*` | 全部 | `status_id: "*"` |

### 組合篩選

```
# 取得專案中開啟的、指派給我的 Issues
取得 my-project 專案中，狀態為開啟，指派給我的 Issues

# 取得所有 Bug（tracker_id=1）
取得所有 Bug 類型的 Issues
```

### 排序

```
# 按更新時間降序
取得 Issues，按更新時間排序

# 按優先度排序
取得 Issues，按優先度排序
```

---

## Skill 功能

安裝包含 Redmine URL 解析 Skill，位於 `.claude/skills/redmine/`。

### 功能

自動將 Redmine 網頁 URL 轉換為 API 呼叫：

| URL 類型 | 轉換結果 |
|----------|----------|
| `/issues/12345` | `redmine_get_issue(id: 12345)` |
| `/projects/xxx/issues?op[status_id]=o` | `redmine_get_issues(project_id: "xxx", status_id: "open")` |

### URL 參數對應

| URL 參數 | API 參數 |
|----------|----------|
| `op[status_id]=o` | `status_id: "open"` |
| `op[status_id]=c` | `status_id: "closed"` |
| `op[tracker_id]==` + `v[tracker_id][]=20` | `tracker_id: 20` |
| `op[assigned_to_id]==` + `v[assigned_to_id][]=me` | `assigned_to_id: "me"` |
| `op[assigned_to_id]=!` + `v[assigned_to_id][]=42` | `assigned_to_id: "!42"` |

---

## 常見問題

### Q: 出現 401 Unauthorized 錯誤

確認 API Token 正確：
1. 重新取得 Token（我的帳戶 → API 存取金鑰 → 顯示）
2. 確認 `.mcp.json` 或 `opencode.json` 中的 `REDMINE_TOKEN` 值正確

### Q: MCP 工具沒有出現

1. 確認設定檔位置正確
2. 重啟 Claude Code 或 OpenCode
3. 檢查 `/tmp/redmine-mcp.log` 查看錯誤訊息

### Q: 如何查看 debug log

```bash
tail -f /tmp/redmine-mcp.log
```

---

## 設定檔位置

| 工具 | 設定檔 |
|------|--------|
| Claude Code | 專案目錄下的 `.mcp.json` |
| OpenCode | 專案目錄下的 `opencode.json` |

---

## 支援

如有問題，請檢查：
1. API Token 是否正確
2. Redmine URL 是否可連線
3. 設定檔格式是否正確

查看 log 檔案取得更多資訊：
```bash
cat /tmp/redmine-mcp.log
```
